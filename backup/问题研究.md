[  154s] [  5%] Building ASM object projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-arm.dir/arm/sync_fetch_and_umax_4.S.o
[  154s] [  5%] Building ASM object projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-arm.dir/arm/sync_fetch_and_umax_8.S.o
[  154s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/truncdfbf2.c: In function '__truncdfbf2':
[  154s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/truncdfbf2.c:13:74: error: unrecognizable insn:
[  154s]    13 | COMPILER_RT_ABI dst_t __truncdfbf2(double a) { return __truncXfYf2__(a); }
[  154s]       |                                                                          ^
[  154s] (insn 298 297 302 57 (set (reg:BF 156 [ <retval> ])
[  154s]         (subreg:BF (reg:HI 273) 0)) "/home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/truncdfbf2.c":13:55 discrim 1 -1
[  154s]      (nil))
[  154s] during RTL pass: vregs
[  154s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/truncdfbf2.c:13:74: internal compiler error: in extract_insn, at recog.cc:2812
[  154s] 0x1a7c782 internal_error(char const*, ...)
[  154s] 	???:0
[  154s] 0x725e97 fancy_abort(char const*, int, char const*)
[  154s] 	???:0
[  154s] 0x70298b _fatal_insn(char const*, rtx_def const*, char const*, int, char const*)
[  154s] 	???:0
[  154s] 0x7029aa _fatal_insn_not_found(rtx_def const*, char const*, int, char const*)
[  154s] 	???:0
[  154s] Please submit a full bug report, with preprocessed source (by using -freport-bug).
[  154s] Please include the complete backtrace with any bug report.
[  154s] See <http://bugs.tizen.org/> for instructions.
[  154s] make[2]: *** [projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-armv4t.dir/build.make:2044: projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-armv4t.dir/truncdfbf2.c.o] Error 1
[  154s] make[1]: *** [CMakeFiles/Makefile2:31284: projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-armv4t.dir/all] Error 2
[  154s] make[1]: *** Waiting for unfinished jobs....

问题分析
看日志这是在编 compiler-rt 的 builtins（目标库：clang_rt.builtins-armv4t）时，文件 truncdfbf2.c 里实现 double -> bfloat16 转换的例程在 GCC 上崩了（reg:BF / BF=bfloat16）。ARMv4T 后端并不真正支持 BFLOAT16 的指令/模式，GCC 前端虽然能接受 __bf16 这个类型，但到后端生成 RTL 时就炸在 extract_insn（“unrecognizable insn … reg:BF … during RTL pass: vregs”），这属于编译器/目标组合不支持 BFMODE 的经典坑，不是你的工程代码问题。对应的源文件确实是 bfloat16 截断实现：lib/builtins/truncdfbf2.c（就是把 DST_BFLOAT 打开后包含通用实现）
[Code Browser](https://codebrowser.dev/llvm/compiler-rt/lib/builtins/truncdfbf2.c.html)
。
在 CMake 里，compiler-rt 只有在检测到 __bf16 类型“可编译”时才会把这批 BF16 源加入构建（BF16_SOURCES 列表）；每个目标架构都会做一次 check_c_source_compiles("__bf16 ...", COMPILER_RT_HAS_${arch}_BFLOAT16)，若为真就把 BF16_SOURCES 追加进该架构的源码列表。你的环境里这一步误判为“可用”，于是把 truncdfbf2.c 等文件编进去，随后在 ARMv4T 的 GCC 后端挂了。相关 CMake 逻辑可见这里（定义 BF16 源并按每个 arch 判断是否加入）
[fossies.org](https://fossies.org/linux/llvm-project-llvmorg/compiler-rt/lib/builtins/CMakeLists.txt)
。LLVM 也专门有改动说明“只在（确实）支持时构建 (b)float16 代码”

尝试方案
rm -rf build && mkdir build
cd build

cmake -G Ninja ../llvm \
  -DLLVM_ENABLE_PROJECTS="clang;compiler-rt" \
  -DLLVM_ENABLE_RUNTIMES="compiler-rt" \
  -DLLVM_BUILTIN_TARGETS="armv4t-linux-gnueabi" \
  -DBUILTINS_armv4t-linux-gnueabi_CMAKE_SYSTEM_NAME=Linux \
  -DBUILTINS_armv4t-linux-gnueabi_TARGET_TRIPLE=armv4t-linux-gnueabi \
  -DBUILTINS_armv4t-linux-gnueabi_CMAKE_C_FLAGS="-march=armv4t -mfloat-abi=soft" \
  **-DCOMPILER_RT_HAS_armv4t_BFLOAT16=OFF**

ninja clang_rt.builtins-armv4t



--------------------------------------------------------------------------------------------------------------------------------------------

[ 1965s] [ 82%] Building CXX object tools/llvm-exegesis/lib/CMakeFiles/LLVMExegesis.dir/BenchmarkResult.cpp.o
[ 1965s] In member function 'resizePath',
[ 1965s]     inlined from 'resizePath' at /home/abuild/rpmbuild/BUILD/llvm-19.1.4/clang/lib/AST/APValue.cpp:236:8,
[ 1965s]     inlined from 'setLValueUninit' at /home/abuild/rpmbuild/BUILD/llvm-19.1.4/clang/lib/AST/APValue.cpp:1035:18,
[ 1965s]     inlined from 'readAPValue' at /home/abuild/rpmbuild/BUILD/llvm-19.1.4/build/tools/clang/include/clang/AST/AbstractBasicReader.inc:770:60:
[ 1965s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/clang/lib/AST/APValue.cpp:243:43: warning: argument 1 value '4294967295' exceeds maximum object size 2147483647 [-Walloc-size-larger-than=]
[ 1965s]   243 |       PathPtr = new LValuePathEntry[Length];
[ 1965s]       |                                           ^
[ 1965s] /usr/lib/gcc/armv7l-tizen-linux-gnueabi/14.2.0/include/c++/new: In member function 'readAPValue':
[ 1965s] /usr/lib/gcc/armv7l-tizen-linux-gnueabi/14.2.0/include/c++/new:133:26: note: in a call to allocation function 'operator new []' declared here
[ 1965s]   133 | _GLIBCXX_NODISCARD void* operator new[](std::size_t) _GLIBCXX_THROW (std::bad_alloc)
[ 1965s]       |                          ^
[ 1965s] In member function 'setVectorUninit',
[ 1965s]     inlined from 'readAPValue' at /home/abuild/rpmbuild/BUILD/llvm-19.1.4/build/tools/clang/include/clang/AST/AbstractBasicReader.inc:630:33:
[ 1965s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/clang/include/clang/AST/APValue.h:690:28: warning: argument 1 value '4294967295' exceeds maximum object size 2147483647 [-Walloc-size-larger-than=]
[ 1965s]   690 |     V->Elts = new APValue[N];
[ 1965s]       |                            ^
[ 1965s] /usr/lib/gcc/armv7l-tizen-linux-gnueabi/14.2.0/include/c++/new: In member function 'readAPValue':
[ 1965s] /usr/lib/gcc/armv7l-tizen-linux-gnueabi/14.2.0/include/c++/new:133:26: note: in a call to allocation function 'operator new []' declared here
[ 1965s]   133 | _GLIBCXX_NODISCARD void* operator new[](std::size_t) _GLIBCXX_THROW (std::bad_alloc)
[ 1965s]       |                          ^
[ 1967s] [ 82%] Building CXX object lib/Target/AArch64/CMakeFiles/LLVMAArch64CodeGen.dir/AArch64CallingConvention.cpp.o
[ 1970s] [ 82%] Built target llvm-profgen
[ 1975s] [ 82%] Building CXX object lib/Target/AArch64/CMakeFiles/LLVMAArch64CodeGen.dir/AArch64CleanupLocalDynamicTLSPass.cpp.o
[ 1975s] [ 82%] Building CXX object lib/Target/BPF/CMakeFiles/LLVMBPFCodeGen.dir/BPFInstrInfo.cpp.o
[ 1979s] armv7l-tizen-linux-gnueabi-g++: fatal error: Killed signal terminated program lto1
[ 1979s] compilation terminated.
[ 1979s] lto-wrapper: fatal error: /bin/armv7l-tizen-linux-gnueabi-g++ returned 1 exit status
[ 1979s] compilation terminated.
[ 1979s] /usr/lib/gcc/armv7l-tizen-linux-gnueabi/14.2.0/../../../../armv7l-tizen-linux-gnueabi/bin/ld: error: lto-wrapper failed
[ 1980s] [ 82%] Building CXX object lib/Target/ARM/CMakeFiles/LLVMARMCodeGen.dir/ARMInstructionSelector.cpp.o
[ 1980s] collect2: error: ld returned 1 exit status
[ 1980s] make[2]: *** [tools/clang/tools/extra/clang-tidy/tool/CMakeFiles/clang-tidy.dir/build.make:238: bin/clang-tidy] Error 1
[ 1980s] make[1]: *** [CMakeFiles/Makefile2:63410: tools/clang/tools/extra/clang-tidy/tool/CMakeFiles/clang-tidy.dir/all] Error 2
[ 1980s] make[1]: *** Waiting for unfinished jobs....

致命错误：armv7l-...-g++: fatal error: Killed signal terminated program lto1 / lto-wrapper failed，最终 link clang-tidy 时失败。
→ 这基本是 GCC LTO（-flto）在 32-bit ARM 构建时内存被 OOM 干掉 的典型栈。lto1 是 GCC 的 LTO 进程，链接阶段要把大量 IR 合并，armv7l 的用户态地址空间小（2–3GB），很容易被杀。真正的失败发生在 链接 clang-tidy（对象极多、最吃内存）。

尝试方案

cmake -G Ninja ../llvm \
  -DLLVM_ENABLE_PROJECTS="clang;lld;compiler-rt" \
  -DLLVM_ENABLE_RUNTIMES="compiler-rt" \
  -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++ \
  -DLLVM_ENABLE_LTO=OFF \
  -DCMAKE_INTERPROCEDURAL_OPTIMIZATION=OFF \
  -DLLVM_ENABLE_LLD=ON \
  -DCMAKE_C_FLAGS="-fno-lto" \
  -DCMAKE_CXX_FLAGS="-fno-lto"

ninja
