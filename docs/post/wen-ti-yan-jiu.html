<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="dark" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />
    
    <link rel="icon" href="https://github.githubassets.com/favicons/favicon.svg"><script>
        let theme = localStorage.getItem("meek_theme") || "light";
        document.documentElement.setAttribute("data-color-mode", theme);
    </script>
<meta name="description" content="[  154s] [  5%] Building ASM object projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-arm.dir/arm/sync_fetch_and_umax_4.S.o
[  154s] [  5%] Building ASM object projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-arm.dir/arm/sync_fetch_and_umax_8.S.o
[  154s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/truncdfbf2.c: In function '__truncdfbf2':
[  154s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/truncdfbf2.c:13:74: error: unrecognizable insn:
[  154s]    13 | COMPILER_RT_ABI dst_t __truncdfbf2(double a) { return __truncXfYf2__(a); }
[  154s]       |                                                                          ^
[  154s] (insn 298 297 302 57 (set (reg:BF 156 [ <retval> ])
[  154s]         (subreg:BF (reg:HI 273) 0)) '/home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/truncdfbf2.c':13:55 discrim 1 -1
[  154s]      (nil))
[  154s] during RTL pass: vregs
[  154s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/truncdfbf2.c:13:74: internal compiler error: in extract_insn, at recog.cc:2812
[  154s] 0x1a7c782 internal_error(char const*, ...)
[  154s] 	???:0
[  154s] 0x725e97 fancy_abort(char const*, int, char const*)
[  154s] 	???:0
[  154s] 0x70298b _fatal_insn(char const*, rtx_def const*, char const*, int, char const*)
[  154s] 	???:0
[  154s] 0x7029aa _fatal_insn_not_found(rtx_def const*, char const*, int, char const*)
[  154s] 	???:0
[  154s] Please submit a full bug report, with preprocessed source (by using -freport-bug).
[  154s] Please include the complete backtrace with any bug report.
[  154s] See <http://bugs.tizen.org/> for instructions.
[  154s] make[2]: *** [projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-armv4t.dir/build.make:2044: projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-armv4t.dir/truncdfbf2.c.o] Error 1
[  154s] make[1]: *** [CMakeFiles/Makefile2:31284: projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-armv4t.dir/all] Error 2
[  154s] make[1]: *** Waiting for unfinished jobs....

问题分析
看日志这是在编 compiler-rt 的 builtins（目标库：clang_rt.builtins-armv4t）时，文件 truncdfbf2.c 里实现 double -> bfloat16 转换的例程在 GCC 上崩了（reg:BF / BF=bfloat16）。">
<meta property="og:title" content="问题研究">
<meta property="og:description" content="[  154s] [  5%] Building ASM object projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-arm.dir/arm/sync_fetch_and_umax_4.S.o
[  154s] [  5%] Building ASM object projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-arm.dir/arm/sync_fetch_and_umax_8.S.o
[  154s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/truncdfbf2.c: In function '__truncdfbf2':
[  154s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/truncdfbf2.c:13:74: error: unrecognizable insn:
[  154s]    13 | COMPILER_RT_ABI dst_t __truncdfbf2(double a) { return __truncXfYf2__(a); }
[  154s]       |                                                                          ^
[  154s] (insn 298 297 302 57 (set (reg:BF 156 [ <retval> ])
[  154s]         (subreg:BF (reg:HI 273) 0)) '/home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/truncdfbf2.c':13:55 discrim 1 -1
[  154s]      (nil))
[  154s] during RTL pass: vregs
[  154s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/truncdfbf2.c:13:74: internal compiler error: in extract_insn, at recog.cc:2812
[  154s] 0x1a7c782 internal_error(char const*, ...)
[  154s] 	???:0
[  154s] 0x725e97 fancy_abort(char const*, int, char const*)
[  154s] 	???:0
[  154s] 0x70298b _fatal_insn(char const*, rtx_def const*, char const*, int, char const*)
[  154s] 	???:0
[  154s] 0x7029aa _fatal_insn_not_found(rtx_def const*, char const*, int, char const*)
[  154s] 	???:0
[  154s] Please submit a full bug report, with preprocessed source (by using -freport-bug).
[  154s] Please include the complete backtrace with any bug report.
[  154s] See <http://bugs.tizen.org/> for instructions.
[  154s] make[2]: *** [projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-armv4t.dir/build.make:2044: projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-armv4t.dir/truncdfbf2.c.o] Error 1
[  154s] make[1]: *** [CMakeFiles/Makefile2:31284: projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-armv4t.dir/all] Error 2
[  154s] make[1]: *** Waiting for unfinished jobs....

问题分析
看日志这是在编 compiler-rt 的 builtins（目标库：clang_rt.builtins-armv4t）时，文件 truncdfbf2.c 里实现 double -> bfloat16 转换的例程在 GCC 上崩了（reg:BF / BF=bfloat16）。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://lhmax2010.github.io/post/wen-ti-yan-jiu.html">
<meta property="og:image" content="https://github.githubassets.com/favicons/favicon.svg">
<title>问题研究</title>



</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}

</style>




<body>
    <div id="header">
<h1 class="postTitle">问题研究</h1>
<div class="title-right">
    <a href="https://lhmax2010.github.io" id="buttonHome" class="btn btn-invisible circle" title="首页">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    
    <a href="https://github.com/lhmax2010/lhmax2010.github.io/issues/14" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16">
            <path id="pathIssue" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="切换主题">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><p>[  154s] [  5%] Building ASM object projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-arm.dir/arm/sync_fetch_and_umax_4.S.o<br>
[  154s] [  5%] Building ASM object projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-arm.dir/arm/sync_fetch_and_umax_8.S.o<br>
[  154s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/truncdfbf2.c: In function '__truncdfbf2':<br>
[  154s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/truncdfbf2.c:13:74: error: unrecognizable insn:<br>
[  154s]    13 | COMPILER_RT_ABI dst_t __truncdfbf2(double a) { return <strong>truncXfYf2</strong>(a); }<br>
[  154s]       |                                                                          ^<br>
[  154s] (insn 298 297 302 57 (set (reg:BF 156 [  ])<br>
[  154s]         (subreg:BF (reg:HI 273) 0)) "/home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/truncdfbf2.c":13:55 discrim 1 -1<br>
[  154s]      (nil))<br>
[  154s] during RTL pass: vregs<br>
[  154s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/truncdfbf2.c:13:74: internal compiler error: in extract_insn, at recog.cc:2812<br>
[  154s] 0x1a7c782 internal_error(char const*, ...)<br>
[  154s] 	???:0<br>
[  154s] 0x725e97 fancy_abort(char const*, int, char const*)<br>
[  154s] 	???:0<br>
[  154s] 0x70298b _fatal_insn(char const*, rtx_def const*, char const*, int, char const*)<br>
[  154s] 	???:0<br>
[  154s] 0x7029aa _fatal_insn_not_found(rtx_def const*, char const*, int, char const*)<br>
[  154s] 	???:0<br>
[  154s] Please submit a full bug report, with preprocessed source (by using -freport-bug).<br>
[  154s] Please include the complete backtrace with any bug report.<br>
[  154s] See <a href="http://bugs.tizen.org/" rel="nofollow">http://bugs.tizen.org/</a> for instructions.<br>
[  154s] make[2]: *** [projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-armv4t.dir/build.make:2044: projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-armv4t.dir/truncdfbf2.c.o] Error 1<br>
[  154s] make[1]: *** [CMakeFiles/Makefile2:31284: projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-armv4t.dir/all] Error 2<br>
[  154s] make[1]: *** Waiting for unfinished jobs....</p>
<p>问题分析<br>
看日志这是在编 compiler-rt 的 builtins（目标库：clang_rt.builtins-armv4t）时，文件 truncdfbf2.c 里实现 double -&gt; bfloat16 转换的例程在 GCC 上崩了（reg:BF / BF=bfloat16）。ARMv4T 后端并不真正支持 BFLOAT16 的指令/模式，GCC 前端虽然能接受 __bf16 这个类型，但到后端生成 RTL 时就炸在 extract_insn（“unrecognizable insn … reg:BF … during RTL pass: vregs”），这属于编译器/目标组合不支持 BFMODE 的经典坑，不是你的工程代码问题。对应的源文件确实是 bfloat16 截断实现：lib/builtins/truncdfbf2.c（就是把 DST_BFLOAT 打开后包含通用实现）<br>
<a href="https://codebrowser.dev/llvm/compiler-rt/lib/builtins/truncdfbf2.c.html" rel="nofollow">Code Browser</a><br>
。<br>
在 CMake 里，compiler-rt 只有在检测到 __bf16 类型“可编译”时才会把这批 BF16 源加入构建（BF16_SOURCES 列表）；每个目标架构都会做一次 check_c_source_compiles("_<em>bf16 ...", COMPILER_RT_HAS</em>${arch}_BFLOAT16)，若为真就把 BF16_SOURCES 追加进该架构的源码列表。你的环境里这一步误判为“可用”，于是把 truncdfbf2.c 等文件编进去，随后在 ARMv4T 的 GCC 后端挂了。相关 CMake 逻辑可见这里（定义 BF16 源并按每个 arch 判断是否加入）<br>
<a href="https://fossies.org/linux/llvm-project-llvmorg/compiler-rt/lib/builtins/CMakeLists.txt" rel="nofollow">fossies.org</a><br>
。LLVM 也专门有改动说明“只在（确实）支持时构建 (b)float16 代码”</p>
<p>尝试方案<br>
rm -rf build &amp;&amp; mkdir build<br>
cd build</p>
<p>cmake -G Ninja ../llvm <br>
-DLLVM_ENABLE_PROJECTS="clang;compiler-rt" <br>
-DLLVM_ENABLE_RUNTIMES="compiler-rt" <br>
-DLLVM_BUILTIN_TARGETS="armv4t-linux-gnueabi" <br>
-DBUILTINS_armv4t-linux-gnueabi_CMAKE_SYSTEM_NAME=Linux <br>
-DBUILTINS_armv4t-linux-gnueabi_TARGET_TRIPLE=armv4t-linux-gnueabi <br>
-DBUILTINS_armv4t-linux-gnueabi_CMAKE_C_FLAGS="-march=armv4t -mfloat-abi=soft" <br>
<strong>-DCOMPILER_RT_HAS_armv4t_BFLOAT16=OFF</strong></p>
<p>ninja clang_rt.builtins-armv4t</p>
<hr>
<p>[ 1965s] [ 82%] Building CXX object tools/llvm-exegesis/lib/CMakeFiles/LLVMExegesis.dir/BenchmarkResult.cpp.o<br>
[ 1965s] In member function 'resizePath',<br>
[ 1965s]     inlined from 'resizePath' at /home/abuild/rpmbuild/BUILD/llvm-19.1.4/clang/lib/AST/APValue.cpp:236:8,<br>
[ 1965s]     inlined from 'setLValueUninit' at /home/abuild/rpmbuild/BUILD/llvm-19.1.4/clang/lib/AST/APValue.cpp:1035:18,<br>
[ 1965s]     inlined from 'readAPValue' at /home/abuild/rpmbuild/BUILD/llvm-19.1.4/build/tools/clang/include/clang/AST/AbstractBasicReader.inc:770:60:<br>
[ 1965s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/clang/lib/AST/APValue.cpp:243:43: warning: argument 1 value '4294967295' exceeds maximum object size 2147483647 [-Walloc-size-larger-than=]<br>
[ 1965s]   243 |       PathPtr = new LValuePathEntry[Length];<br>
[ 1965s]       |                                           ^<br>
[ 1965s] /usr/lib/gcc/armv7l-tizen-linux-gnueabi/14.2.0/include/c++/new: In member function 'readAPValue':<br>
[ 1965s] /usr/lib/gcc/armv7l-tizen-linux-gnueabi/14.2.0/include/c++/new:133:26: note: in a call to allocation function 'operator new []' declared here<br>
[ 1965s]   133 | _GLIBCXX_NODISCARD void* operator new _GLIBCXX_THROW (std::bad_alloc)<br>
[ 1965s]       |                          ^<br>
[ 1965s] In member function 'setVectorUninit',<br>
[ 1965s]     inlined from 'readAPValue' at /home/abuild/rpmbuild/BUILD/llvm-19.1.4/build/tools/clang/include/clang/AST/AbstractBasicReader.inc:630:33:<br>
[ 1965s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/clang/include/clang/AST/APValue.h:690:28: warning: argument 1 value '4294967295' exceeds maximum object size 2147483647 [-Walloc-size-larger-than=]<br>
[ 1965s]   690 |     V-&gt;Elts = new APValue[N];<br>
[ 1965s]       |                            ^<br>
[ 1965s] /usr/lib/gcc/armv7l-tizen-linux-gnueabi/14.2.0/include/c++/new: In member function 'readAPValue':<br>
[ 1965s] /usr/lib/gcc/armv7l-tizen-linux-gnueabi/14.2.0/include/c++/new:133:26: note: in a call to allocation function 'operator new []' declared here<br>
[ 1965s]   133 | _GLIBCXX_NODISCARD void* operator new _GLIBCXX_THROW (std::bad_alloc)<br>
[ 1965s]       |                          ^<br>
[ 1967s] [ 82%] Building CXX object lib/Target/AArch64/CMakeFiles/LLVMAArch64CodeGen.dir/AArch64CallingConvention.cpp.o<br>
[ 1970s] [ 82%] Built target llvm-profgen<br>
[ 1975s] [ 82%] Building CXX object lib/Target/AArch64/CMakeFiles/LLVMAArch64CodeGen.dir/AArch64CleanupLocalDynamicTLSPass.cpp.o<br>
[ 1975s] [ 82%] Building CXX object lib/Target/BPF/CMakeFiles/LLVMBPFCodeGen.dir/BPFInstrInfo.cpp.o<br>
[ 1979s] armv7l-tizen-linux-gnueabi-g++: fatal error: Killed signal terminated program lto1<br>
[ 1979s] compilation terminated.<br>
[ 1979s] lto-wrapper: fatal error: /bin/armv7l-tizen-linux-gnueabi-g++ returned 1 exit status<br>
[ 1979s] compilation terminated.<br>
[ 1979s] /usr/lib/gcc/armv7l-tizen-linux-gnueabi/14.2.0/../../../../armv7l-tizen-linux-gnueabi/bin/ld: error: lto-wrapper failed<br>
[ 1980s] [ 82%] Building CXX object lib/Target/ARM/CMakeFiles/LLVMARMCodeGen.dir/ARMInstructionSelector.cpp.o<br>
[ 1980s] collect2: error: ld returned 1 exit status<br>
[ 1980s] make[2]: *** [tools/clang/tools/extra/clang-tidy/tool/CMakeFiles/clang-tidy.dir/build.make:238: bin/clang-tidy] Error 1<br>
[ 1980s] make[1]: *** [CMakeFiles/Makefile2:63410: tools/clang/tools/extra/clang-tidy/tool/CMakeFiles/clang-tidy.dir/all] Error 2<br>
[ 1980s] make[1]: *** Waiting for unfinished jobs....</p>
<p>致命错误：armv7l-...-g++: fatal error: Killed signal terminated program lto1 / lto-wrapper failed，最终 link clang-tidy 时失败。<br>
→ 这基本是 GCC LTO（-flto）在 32-bit ARM 构建时内存被 OOM 干掉 的典型栈。lto1 是 GCC 的 LTO 进程，链接阶段要把大量 IR 合并，armv7l 的用户态地址空间小（2–3GB），很容易被杀。真正的失败发生在 链接 clang-tidy（对象极多、最吃内存）。</p>
<p>尝试方案</p>
<p>cmake -G Ninja ../llvm <br>
-DLLVM_ENABLE_PROJECTS="clang;lld;compiler-rt" <br>
-DLLVM_ENABLE_RUNTIMES="compiler-rt" <br>
-DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++ <br>
-DLLVM_ENABLE_LTO=OFF <br>
-DCMAKE_INTERPROCEDURAL_OPTIMIZATION=OFF <br>
-DLLVM_ENABLE_LLD=ON <br>
-DCMAKE_C_FLAGS="-fno-lto" <br>
-DCMAKE_CXX_FLAGS="-fno-lto"</p>
<h2>ninja</h2>
<p>[  140s] [  0%] Building CXX object projects/compiler-rt/lib/lsan/CMakeFiles/RTLSanCommon.arm.dir/lsan_common.cpp.o<br>
[  140s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/arm/bswapdi2.S: Assembler messages:<br>
[  140s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/arm/bswapdi2.S:25: Error: cannot honor width suffix -- <code class="notranslate">eor r2,r0,r0,ror#16' [  140s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/arm/bswapdi2.S:26: Error: cannot honor width suffix -- </code>bic r2,r2,#0xff0000'<br>
[  140s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/arm/bswapdi2.S:27: Error: cannot honor width suffix -- <code class="notranslate">mov r2,r2,lsr#8' [  140s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/arm/bswapdi2.S:28: Error: cannot honor width suffix -- </code>eor r2,r2,r0,ror#8'<br>
[  140s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/arm/bswapdi2.S:30: Error: cannot honor width suffix -- <code class="notranslate">eor r0,r1,r1,ror#16' [  140s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/arm/bswapdi2.S:31: Error: cannot honor width suffix -- </code>bic r0,r0,#0xff0000'<br>
[  140s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/arm/bswapdi2.S:32: Error: cannot honor width suffix -- <code class="notranslate">mov r0,r0,lsr#8' [  140s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/arm/bswapdi2.S:33: Error: cannot honor width suffix -- </code>eor r0,r0,r1,ror#8'<br>
[  140s] /home/abuild/rpmbuild/BUILD/llvm-19.1.4/compiler-rt/lib/builtins/arm/bswapdi2.S:38: Error: MOV Rd, Rs with two low registers is not permitted on this architecture -- `mov r1,r2'<br>
[  140s] make[2]: *** [projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-armv4t.dir/build.make:92: projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-armv4t.dir/arm/bswapdi2.S.o] Error 1<br>
[  140s] make[1]: *** [CMakeFiles/Makefile2:31284: projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-armv4t.dir/all] Error 2<br>
[  140s] make[1]: *** Waiting for unfinished jobs....<br>
[  140s] [  0%] Copying compiler-rt's sanitizer/asan_interface.h...<br>
[  140s] cc1plus: warning: '-Wformat-security' ignored without '-Wformat' [-Wformat-security]</p>
<p>原因是：你在构建 clang_rt.builtins-armv4t 时启用了 Thumb-1（-mthumb），但 compiler-rt/lib/builtins/arm/bswapdi2.S 里用的是 ARM 状态才有的指令/编码（例如 EOR ... , ROR #imm 这种“带桶形移位”的第二操作数形式、以及需要 32 位宽编码的变体）。<br>
ARMv4T 的 Thumb-1 不支持这些编码，于是出现：</p>
<p>cannot honor width suffix（提示无法满足 32 位宽指令 .w/宽编码的需求）</p>
<p>MOV Rd, Rs with two low registers is not permitted on this architecture（在它试图选用 Thumb 的 16 位变体时触发的约束错误）</p>
<p>一系列 eor/bic/mov ... ror#... 的报错</p>
<p>实际上用的是armv7l， 所以需要修正配置</p>
<p>尝试方案</p>
<h1>单独构建 compiler-rt（或在 monorepo 的 runtimes 里等价传参）</h1>
<p>cmake -S compiler-rt -B build-rt <br>
-DCMAKE_BUILD_TYPE=Release <br>
-DCMAKE_C_COMPILER=clang <br>
-DCMAKE_ASM_COMPILER=clang <br>
-DLLVM_CONFIG_PATH=/path/to/llvm-config <br>
-DCOMPILER_RT_BUILD_BUILTINS=ON <br>
-DCOMPILER_RT_BUILD_SANITIZERS=OFF <br>
-DCOMPILER_RT_DEFAULT_TARGET_TRIPLE=armv7a-linux-gnueabihf <br>
-DCOMPILER_RT_DEFAULT_TARGET_ONLY=ON <br>
-DCMAKE_C_FLAGS="--target=armv7a-linux-gnueabihf -march=armv7-a -marm" <br>
-DCMAKE_ASM_FLAGS="--target=armv7a-linux-gnueabihf -march=armv7-a -marm"</p>
<p>cmake --build build-rt -j</p>
<hr>
<p>Coredump 分析</p>
<p>Backtrace from coredump: Coredump.DN_artThingsApp.video_appsrc-sr(dotnet-loader).14355.__TIZEN-TRUNK2025-PontusM-RELEASE_20250905.4__T-PTMFAKUC-0090_debug<br>
Process path: /usr/bin/dotnet-loader<br>
From Package: dotnet-launcher<br>
GNU gdb (GDB) 8.3.50.20191012-git<br>
Copyright (C) 2019 Free Software Foundation, Inc.<br>
License GPLv3+: GNU GPL version 3 or later <a href="http://gnu.org/licenses/gpl.html" rel="nofollow">http://gnu.org/licenses/gpl.html</a><br>
This is free software: you are free to change and redistribute it.<br>
There is NO WARRANTY, to the extent permitted by law.<br>
Type "show copying" and "show warranty" for details.<br>
This GDB was configured as "--host=x86_64-pc-linux-gnu --target=armv7l-tizen-linux-gnueabi".<br>
Type "show configuration" for configuration details.<br>
For bug reporting instructions, please see:<br>
<a href="http://bugs.tizen.org/" rel="nofollow">http://bugs.tizen.org/</a>.<br>
Find the GDB manual and other documentation resources online at:<br>
<a href="http://www.gnu.org/software/gdb/documentation/" rel="nofollow">http://www.gnu.org/software/gdb/documentation/</a>.</p>
<p>For help, type "help".<br>
Type "apropos word" to search for commands related to "word".<br>
[New LWP 14355]<br>
[New LWP 14105]<br>
[New LWP 13804]<br>
[New LWP 13835]<br>
[New LWP 14354]<br>
[New LWP 14347]<br>
[New LWP 14341]<br>
[New LWP 14058]<br>
[New LWP 14256]<br>
[New LWP 14241]<br>
[New LWP 13828]<br>
[New LWP 14266]<br>
[New LWP 14111]<br>
[New LWP 13108]<br>
[New LWP 13832]<br>
[New LWP 13107]<br>
[New LWP 13897]<br>
[New LWP 13800]<br>
[New LWP 13838]<br>
[New LWP 13112]<br>
[New LWP 14348]<br>
[New LWP 14340]<br>
[New LWP 13902]<br>
[New LWP 13894]<br>
[New LWP 14240]<br>
[New LWP 14318]<br>
[New LWP 13831]<br>
[New LWP 7608]<br>
[New LWP 13837]<br>
[New LWP 14098]<br>
[New LWP 14243]<br>
[New LWP 14391]<br>
[New LWP 14258]<br>
[New LWP 14374]<br>
[New LWP 14260]<br>
[New LWP 14250]<br>
[New LWP 13907]<br>
[New LWP 13822]<br>
[New LWP 14368]<br>
[New LWP 13834]<br>
[New LWP 14319]<br>
[New LWP 14101]<br>
[New LWP 13817]<br>
[New LWP 14102]<br>
[New LWP 13810]<br>
[New LWP 13821]<br>
[New LWP 13829]<br>
[New LWP 13807]<br>
[New LWP 14373]<br>
[New LWP 13809]<br>
[New LWP 13798]<br>
[New LWP 13808]<br>
[New LWP 14357]<br>
[New LWP 13833]<br>
[New LWP 14342]<br>
[New LWP 14252]<br>
[New LWP 13999]<br>
[New LWP 14310]<br>
[New LWP 14317]<br>
[New LWP 14261]<br>
[New LWP 13830]<br>
[New LWP 13106]<br>
[New LWP 13812]<br>
[New LWP 14249]<br>
[New LWP 14242]<br>
[New LWP 14320]<br>
[New LWP 13134]<br>
[New LWP 13103]<br>
[New LWP 13802]<br>
[New LWP 13819]<br>
[New LWP 13892]<br>
[New LWP 13895]<br>
[New LWP 13903]<br>
[New LWP 13906]<br>
[New LWP 13909]<br>
[New LWP 14025]<br>
[New LWP 14033]<br>
[New LWP 14104]<br>
[New LWP 14245]<br>
[New LWP 14251]<br>
[New LWP 14262]<br>
[New LWP 14269]<br>
[New LWP 14321]<br>
[New LWP 14311]<br>
[New LWP 14346]<br>
[New LWP 14353]<br>
[New LWP 14356]<br>
[New LWP 14308]<br>
[New LWP 14360]<br>
[New LWP 14314]<br>
[New LWP 14361]<br>
[New LWP 14367]<br>
[New LWP 13791]<br>
[New LWP 14369]<br>
[New LWP 14371]<br>
[New LWP 14370]<br>
[New LWP 14372]<br>
[New LWP 14375]<br>
[New LWP 14377]<br>
[New LWP 13801]<br>
[New LWP 14309]<br>
[New LWP 14343]<br>
[New LWP 14339]<br>
[New LWP 14313]<br>
[New LWP 14344]<br>
[New LWP 14312]<br>
[New LWP 14337]<br>
[New LWP 13806]<br>
[New LWP 13811]<br>
[New LWP 13820]<br>
[New LWP 14378]<br>
[New LWP 14376]<br>
[New LWP 14366]<br>
[New LWP 14338]<br>
[New LWP 14322]<br>
[New LWP 14300]<br>
[New LWP 14268]<br>
[New LWP 14267]<br>
[New LWP 14263]<br>
[New LWP 14254]<br>
[New LWP 14253]<br>
[New LWP 14239]<br>
[New LWP 14187]<br>
[New LWP 14059]<br>
[New LWP 14055]<br>
[New LWP 14030]<br>
[New LWP 14000]<br>
[New LWP 13921]<br>
[New LWP 13920]<br>
[New LWP 13910]<br>
[New LWP 13905]<br>
[New LWP 13904]<br>
[New LWP 13896]<br>
[New LWP 13836]<br>
[New LWP 14359]<br>
[New LWP 14358]<br>
[New LWP 14315]<br>
[New LWP 13786]<br>
[New LWP 13102]<br>
[New LWP 13799]<br>
[New LWP 14259]<br>
[New LWP 14257]<br>
[New LWP 14255]<br>
[New LWP 14248]<br>
Core was generated by `/opt/usr/apps/com.samsung.tv.SmartThingsApp/bin/SmartThingsApp.dll '.<br>
Program terminated with signal SIGSEGV, Segmentation fault.<br>
#0 __GI_raise (sig=sig@entry=11) at ../sysdeps/unix/sysv/linux/raise.c:50<br>
[Current thread is 1 (LWP 14355)]</p>
<p>(gdb)bt<br>
#0 __GI_raise (sig=sig@entry=11) at /usr/src/debug/glibc-2.30-3.16.arm/signal/../sysdeps/unix/sysv/linux/raise.c:50<br>
#1 0xb42dfb18 in onSigsegv (signum=11) at /usr/src/debug/dotnet-launcher-tv-plugin-6.0.95-1.arm/plugin/src/dotnet-signal-handler.cpp:76<br>
#2 0xb3790a06 in invoke_previous_action (action=, code=11, siginfo=0xa41fbc88, context=0xa41fbd08, signalRestarts=true) at /usr/src/debug/coreclr-6.0.9-1.arm/src/coreclr/pal/src/exception/signal.cpp:415<br>
#3 sigsegv_handler (code=11, siginfo=0xa41fbc88, context=0xa41fbd08) at /usr/src/debug/coreclr-6.0.9-1.arm/src/coreclr/pal/src/exception/signal.cpp:627<br>
#4<br>
#5 memcpy () at /usr/src/debug/glibc-2.30-3.16.arm/string/../sysdeps/arm/memcpy.S:108<br>
#6 0xa402bd16 in memcpy (__len=3110400, __src=, __dest=) at /usr/include/bits/string_fortified.h:34<br>
#7 sysmem_copy (mem=0x8b7bdde0, offset=, size=3110400) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gstallocator.c:486<br>
#8 0xa4037286 in gst_buffer_copy_into (size=4953600, offset=0, flags=(GST_BUFFER_COPY_FLAGS | GST_BUFFER_COPY_TIMESTAMPS | GST_BUFFER_COPY_META | GST_BUFFER_COPY_MEMORY | GST_BUFFER_COPY_DEEP), src=0x8b7ddcc8, dest=0xaf5cbcf0) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gstbuffer.c:639<br>
#9 gst_buffer_copy_into (dest=0xaf5cbcf0, src=0x8b7ddcc8, flags=(GST_BUFFER_COPY_FLAGS | GST_BUFFER_COPY_TIMESTAMPS | GST_BUFFER_COPY_META | GST_BUFFER_COPY_MEMORY | GST_BUFFER_COPY_DEEP), offset=0, size=) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gstbuffer.c:543<br>
#10 0xa4037b5c in gst_buffer_copy_with_flags (buffer=0x8b7ddcc8, flags=(GST_BUFFER_COPY_FLAGS | GST_BUFFER_COPY_TIMESTAMPS | GST_BUFFER_COPY_META | GST_BUFFER_COPY_MEMORY | GST_BUFFER_COPY_DEEP)) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gstbuffer.c:744<br>
#11 0xa36037f2 in gst_base_sink_drain (basesink=0xb3dcfee8) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/libs/gst/base/gstbasesink.c:6197<br>
#12 0xa360b5c8 in gst_base_sink_default_query (basesink=0xb3dcfee8, query=0x8b7b1bd0) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/libs/gst/base/gstbasesink.c:6220<br>
#13 0x9145318e in gst_fake_sink_query (bsink=, query=) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/plugins/elements/gstfakesink.c:617<br>
#14 0xa406b842 in gst_pad_query (pad=pad@entry=0xb3dcbbb0, query=query@entry=0x8b7b1bd0) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gstpad.c:4225<br>
#15 0xa406be52 in gst_pad_peer_query (pad=0xb3dcc708, query=query@entry=0x8b7b1bd0) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gstpad.c:4357<br>
#16 0xa3204596 in gst_video_decoder_negotiate_pool (decoder=decoder@entry=0xb3dcc368, caps=) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gst-plugins-base/gst-libs/gst/video/gstvideodecoder.c:4363<br>
#17 0xa3204aca in gst_video_decoder_negotiate_default (decoder=0xb3dcc368) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gst-plugins-base/gst-libs/gst/video/gstvideodecoder.c:4569<br>
#18 0xa32088a4 in gst_video_decoder_negotiate (decoder=decoder@entry=0xb3dcc368) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gst-plugins-base/gst-libs/gst/video/gstvideodecoder.c:4610<br>
#19 0x8e880dfc in gst_ffmpegviddec_negotiate (picture=, context=, ffmpegdec=0xb3dcc368) at /usr/src/debug/gst-ffmpeg-1.45.0.tv-74.arm/ext/ffmpeg/gstffmpegviddec.c:1749<br>
#20 gst_ffmpegviddec_video_frame (ret=0xa7a85500, frame=, ffmpegdec=0xb3dcc368) at /usr/src/debug/gst-ffmpeg-1.45.0.tv-74.arm/ext/ffmpeg/gstffmpegviddec.c:2280<br>
#21 gst_ffmpegviddec_frame (ffmpegdec=ffmpegdec@entry=0xb3dcc368, frame=frame@entry=0x8b7d9e90, ret=ret@entry=0x8421962c) at /usr/src/debug/gst-ffmpeg-1.45.0.tv-74.arm/ext/ffmpeg/gstffmpegviddec.c:2483<br>
#22 0x8e8820e2 in gst_ffmpegviddec_handle_frame (decoder=0xb3dcc368, frame=0x8b7d9e90) at /usr/src/debug/gst-ffmpeg-1.45.0.tv-74.arm/ext/ffmpeg/gstffmpegviddec.c:2645<br>
#23 0xa320a08e in gst_video_decoder_decode_frame (decoder=decoder@entry=0xb3dcc368, frame=frame@entry=0x8b7d9e90) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gst-plugins-base/gst-libs/gst/video/gstvideodecoder.c:4026<br>
#24 0xa320a4fe in gst_video_decoder_chain_forward (decoder=decoder@entry=0xb3dcc368, buf=, buf@entry=0xa5fc7ce8, at_eos=at_eos@entry=0) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gst-plugins-base/gst-libs/gst/video/gstvideodecoder.c:2498<br>
#25 0xa320c4fa in gst_video_decoder_chain (pad=, parent=0xb3dcc368, buf=0xa5fc7ce8) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gst-plugins-base/gst-libs/gst/video/gstvideodecoder.c:2840<br>
#26 0xa4064dd0 in gst_pad_chain_data_unchecked (pad=pad@entry=0xa7a90358, type=type@entry=4112, data=, data@entry=0xa5fc7ce8) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gstpad.c:4486<br>
#27 0xa4066a6a in gst_pad_push_data (pad=pad@entry=0xb3dcd868, type=type@entry=4112, data=data@entry=0xa5fc7ce8) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gstpad.c:4762<br>
#28 0xa406c7c6 in gst_pad_push (pad=pad@entry=0xb3dcd868, buffer=0xa5fc7ce8) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gstpad.c:4881<br>
#29 0xa361578e in gst_base_src_loop (pad=0xb3dcd868) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/libs/gst/base/gstbasesrc.c:3143<br>
#30 0xa4093a7e in gst_task_func (task=0xb3dd0578) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gsttask.c:384<br>
#31 0xb5d93ada in g_thread_pool_free (pool=0x36ab998, immediate=-1987151296, wait=-1430260240) at /usr/src/debug/glib2-2.80.5-0.arm/_build/../glib/gthreadpool.c:913<br>
#32 0xaabff5f0 in ?? ()<br>
Backtrace stopped: previous frame identical to this frame (corrupt stack?)</p>
<p>(gdb)bt full<br>
#0 __GI_raise (sig=sig@entry=11) at /usr/src/debug/glibc-2.30-3.16.arm/signal/../sysdeps/unix/sysv/linux/raise.c:50<br>
set = {_val = {0, 2, 808637559, 3183137896, 15, 3183137624, 3183137896, 0, 3022947500, 3183137792, 3183137944, 3183138164, 3053187216, 0, 3045093848, 4222451713, 3183137896, 3183137896, 520, 3183137896, 3183137898, 3183137911, 3183137896, 3183137911, 0, 0, 0, 0, 0, 0, 0, 0}}<br>
pid =<br>
tid =<br>
ret =<br>
#1 0xb42dfb18 in onSigsegv (signum=11) at /usr/src/debug/dotnet-launcher-tv-plugin-6.0.95-1.arm/plugin/src/dotnet-signal-handler.cpp:76<br>
buffer = "DotNET onSigsegv called on com.samsung.tv.SmartThingsApp / video_appsrc-sr(7608)\n\000\360?\000\000\000\000\000\000\000\200\000\000\000\000\000\000\000\000&lt;TUUUU\305?\000\000\372\376B.v\277\000\000\000\000\000\000\000\000\303?&amp;\213+\000\360?,\252\333u\300\v#@\236\236\020\020\034\261d\277\211f\243\367U!\231?\361\323\330\203b\004@", '\000' &lt;repeats 76 times&gt;...<br>
thread_name = "video_appsrc-sr", '\000' &lt;repeats 21 times&gt;, "\020\000\000@p\275\037\244\070\220!\204\234\220!\204\b\275\037\244\230\272\037\244\004\000\000\000\210\274\037\244\330\270\037\244\004\000\000\000\000\000\000\000\v\000\000\000\v\000 \000\v\000\000\000\210\274\037\244\b\275\037\244\260\272\037\244\070\220!\204\234\220!\204\b\275\037\244\070\220!\204\004\000\000\000\210\274\037\244\330\270\037\244\004\000\000\000\f\000\000\000\070\220!\204\037{\263q\ry\263\020\000\000@\021\000\000`\000\000\000\000", '\200' &lt;repeats 32 times&gt;, "\355R\222\221"...<br>
ret =<br>
#2 0xb3790a06 in invoke_previous_action (action=, code=11, siginfo=0xa41fbc88, context=0xa41fbd08, signalRestarts=true) at /usr/src/debug/coreclr-6.0.9-1.arm/src/coreclr/pal/src/exception/signal.cpp:415<br>
No locals.<br>
#3 sigsegv_handler (code=11, siginfo=0xa41fbc88, context=0xa41fbd08) at /usr/src/debug/coreclr-6.0.9-1.arm/src/coreclr/pal/src/exception/signal.cpp:627<br>
No locals.<br>
#4<br>
No locals.<br>
#5 memcpy () at /usr/src/debug/glibc-2.30-3.16.arm/string/../sysdeps/arm/memcpy.S:108<br>
No locals.<br>
#6 0xa402bd16 in memcpy (__len=3110400, __src=, __dest=) at /usr/include/bits/string_fortified.h:34<br>
No locals.<br>
#7 _sysmem_copy (mem=0x8b7bdde0, offset=, size=3110400) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gstallocator.c:486<br>
copy = 0x7b86a008<br>
func = "_sysmem_copy"<br>
#8 0xa4037286 in gst_buffer_copy_into (size=4953600, offset=0, flags=(GST_BUFFER_COPY_FLAGS | GST_BUFFER_COPY_TIMESTAMPS | GST_BUFFER_COPY_META | GST_BUFFER_COPY_MEMORY | GST_BUFFER_COPY_DEEP), src=0x8b7ddcc8, dest=0xaf5cbcf0) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gstbuffer.c:639<br>
newmem =<br>
tocopy = 3110400<br>
mem = 0x8b7bdde0<br>
len = 2<br>
dest_len = 0<br>
i = 1<br>
bsize =<br>
deep = 32<br>
skip =<br>
left = 3110400<br>
walk =<br>
bufsize =<br>
region =<br>
sharing_mem = 0<br>
walk =<br>
bufsize =<br>
region =<br>
sharing_mem =<br>
func = "gst_buffer_copy_into"<br>
_g_boolean_var_25 =<br>
_g_boolean_var_26 =<br>
_g_boolean_var_27 =<br>
_g_boolean_var_28 =<br>
_g_boolean_var_29 =<br>
_g_boolean_var_30 =<br>
_g_boolean_var_31 =<br>
flags_mask =<br>
skip =<br>
left =<br>
len =<br>
dest_len =<br>
i =<br>
bsize =<br>
deep =<br>
mem =<br>
newmem =<br>
tocopy =<br>
mem =<br>
deep =<br>
meta =<br>
info =<br>
_g_boolean_var_32 =<br>
_g_boolean_var_33 =<br>
copy_data =<br>
_g_boolean_var_34 =<br>
#9 gst_buffer_copy_into (dest=0xaf5cbcf0, src=0x8b7ddcc8, flags=(GST_BUFFER_COPY_FLAGS | GST_BUFFER_COPY_TIMESTAMPS | GST_BUFFER_COPY_META | GST_BUFFER_COPY_MEMORY | GST_BUFFER_COPY_DEEP), offset=0, size=) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gstbuffer.c:543<br>
walk =<br>
bufsize =<br>
func = "gst_buffer_copy_into"<br>
_g_boolean_var_29 =<br>
_g_boolean_var_30 =<br>
_g_boolean_var_31 =<br>
flags_mask =<br>
skip =<br>
left =<br>
len =<br>
dest_len =<br>
i =<br>
bsize =<br>
deep =<br>
mem =<br>
newmem =<br>
tocopy =<br>
mem =<br>
deep =<br>
meta =<br>
info =<br>
_g_boolean_var_32 =<br>
_g_boolean_var_33 =<br>
copy_data =<br>
_g_boolean_var_34 =<br>
#10 0xa4037b5c in gst_buffer_copy_with_flags (buffer=0x8b7ddcc8, flags=(GST_BUFFER_COPY_FLAGS | GST_BUFFER_COPY_TIMESTAMPS | GST_BUFFER_COPY_META | GST_BUFFER_COPY_MEMORY | GST_BUFFER_COPY_DEEP)) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gstbuffer.c:744<br>
copy = 0xaf5cbcf0<br>
func = "gst_buffer_copy_with_flags"<br>
#11 0xa36037f2 in gst_base_sink_drain (basesink=0xb3dcfee8) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/libs/gst/base/gstbasesink.c:6197<br>
old = 0x8b7ddcc8<br>
old_list =<br>
#12 0xa360b5c8 in gst_base_sink_default_query (basesink=0xb3dcfee8, query=0x8b7b1bd0) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/libs/gst/base/gstbasesink.c:6220<br>
res =<br>
bclass =<br>
func = "gst_base_sink_default_query"<br>
#13 0x9145318e in gst_fake_sink_query (bsink=, query=) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/plugins/elements/gstfakesink.c:617<br>
ret =<br>
fmt =<br>
#14 0xa406b842 in gst_pad_query (pad=pad@entry=0xb3dcbbb0, query=query@entry=0x8b7b1bd0) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gstpad.c:4225<br>
parent = 0xb3dcfee8<br>
res =<br>
serialized =<br>
func =<br>
type = GST_PAD_PROBE_TYPE_QUERY_DOWNSTREAM<br>
ret =<br>
func = "gst_pad_query"<br>
_g_boolean_var_280 =<br>
_g_boolean_var_284 =<br>
_g_boolean_var_286 =<br>
_g_boolean_var_288 =<br>
_g_boolean_var_289 =<br>
_g_boolean_var_291 =<br>
_g_boolean_var_293 =<br>
#15 0xa406be52 in gst_pad_peer_query (pad=0xb3dcc708, query=query@entry=0x8b7b1bd0) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gstpad.c:4357<br>
peerpad = 0xb3dcbbb0<br>
type = GST_PAD_PROBE_TYPE_QUERY_DOWNSTREAM<br>
res =<br>
serialized =<br>
ret =<br>
func = "gst_pad_peer_query"<br>
#16 0xa3204596 in gst_video_decoder_negotiate_pool (decoder=decoder@entry=0xb3dcc368, caps=) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gst-plugins-base/gst-libs/gst/video/gstvideodecoder.c:4363<br>
klass = 0xaf5bb708<br>
query = 0x8b7b1bd0<br>
pool = 0x0<br>
allocator = 0x8b7d9a30<br>
params = {flags = GST_MEMORY_FLAG_ZERO_PADDED, align = 0, prefix = 0, padding = 2340264496, _gst_reserved = {0xb05da800, 0xa40c55c4, 0x1, 0xb3dcc368}}<br>
ret = 1<br>
func = "gst_video_decoder_negotiate_pool"<br>
#17 0xa3204aca in gst_video_decoder_negotiate_default (decoder=0xb3dcc368) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gst-plugins-base/gst-libs/gst/video/gstvideodecoder.c:4569<br>
state = 0x8b7d6c10<br>
ret =<br>
frame =<br>
prevcaps = 0xaf55c4a0<br>
incaps =<br>
func = "gst_video_decoder_negotiate_default"<br>
#18 0xa32088a4 in gst_video_decoder_negotiate (decoder=decoder@entry=0xb3dcc368) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gst-plugins-base/gst-libs/gst/video/gstvideodecoder.c:4610<br>
klass =<br>
ret = 1<br>
func = "gst_video_decoder_negotiate"<br>
#19 0x8e880dfc in gst_ffmpegviddec_negotiate (picture=, context=, ffmpegdec=0xb3dcc368) at /usr/src/debug/gst-ffmpeg-1.45.0.tv-74.arm/ext/ffmpeg/gstffmpegviddec.c:1749<br>
in_info =<br>
output_state = 0x8b7d6c10<br>
fps_n =<br>
latency =<br>
sink_mimetype =<br>
width =<br>
height =<br>
fmt =<br>
out_info = 0x8b7d6c14<br>
in_s = 0xa7a85500<br>
fps_d =<br>
version = 0<br>
fmt =<br>
in_info =<br>
out_info =<br>
output_state =<br>
fps_n =<br>
fps_d =<br>
latency =<br>
in_s =<br>
sink_mimetype =<br>
version =<br>
width =<br>
height =<br>
func =<br>
_g_boolean_var_86 =<br>
_g_boolean_var_87 =<br>
_g_boolean_var_88 =<br>
_g_boolean_var_89 =<br>
_g_boolean_var_90 =<br>
_g_boolean_var_91 =<br>
_g_boolean_var_92 =<br>
_g_boolean_var_93 =<br>
_g_boolean_var_94 =<br>
_g_boolean_var_95 =<br>
#20 gst_ffmpegviddec_video_frame (ret=0xa7a85500, frame=, ffmpegdec=0xb3dcc368) at /usr/src/debug/gst-ffmpeg-1.45.0.tv-74.arm/ext/ffmpeg/gstffmpegviddec.c:2280<br>
out_dframe =<br>
pool =<br>
info =<br>
res =<br>
got_frame = 1<br>
mode_switch =<br>
out_frame = 0x8b7d9fc0<br>
res =<br>
got_frame =<br>
mode_switch =<br>
out_frame =<br>
out_dframe =<br>
pool =<br>
info =<br>
func =<br>
_g_boolean_var_122 =<br>
_g_boolean_var_123 =<br>
_g_boolean_var_124 =<br>
_g_boolean_var_125 =<br>
_g_boolean_var_126 =<br>
_g_boolean_var_127 =<br>
_g_boolean_var_128 =<br>
_g_boolean_var_129 =<br>
_g_boolean_var_130 =<br>
_g_boolean_var_131 =<br>
_g_boolean_var_132 =<br>
_g_boolean_var_133 =<br>
in_info =<br>
side_data =<br>
stereo =<br>
frame =<br>
i =<br>
cc_data =<br>
_g_boolean_var_134 =<br>
_g_boolean_var_135 =<br>
_g_boolean_var_136 =<br>
_g_boolean_var_137 =<br>
_g_boolean_var_138 =<br>
_g_boolean_var_139 =<br>
_g_boolean_var_140 =<br>
_g_boolean_var_141 =<br>
_g_boolean_var_142 =<br>
_g_boolean_var_143 =<br>
_g_boolean_var_144 =<br>
_g_boolean_var_145 =<br>
_g_boolean_var_146 =<br>
tmp =<br>
vmeta =<br>
info =<br>
_g_boolean_var_147 =<br>
_g_boolean_var_148 =<br>
_g_boolean_var_149 =<br>
_g_boolean_var_150 =<br>
side_data =<br>
cc_meta =<br>
iter =<br>
found_708_raw_meta =<br>
_g_boolean_var_151 =<br>
_g_boolean_var_152 =<br>
_g_boolean_var_153 =<br>
l =<br>
ol =<br>
dec =<br>
old =<br>
tmp =<br>
_g_boolean_var_154 =<br>
srccaps =<br>
new_caps =<br>
structure =<br>
_g_boolean_var_155 =<br>
par_dar =<br>
_g_boolean_var_156 =<br>
_g_boolean_var_157 =<br>
_g_boolean_var_158 =<br>
_g_boolean_var_159 =<br>
_g_boolean_var_160 =<br>
#21 gst_ffmpegviddec_frame (ffmpegdec=ffmpegdec@entry=0xb3dcc368, frame=frame@entry=0x8b7d9e90, ret=ret@entry=0x8421962c) at /usr/src/debug/gst-ffmpeg-1.45.0.tv-74.arm/ext/ffmpeg/gstffmpegviddec.c:2483<br>
func = "gst_ffmpegviddec_frame"<br>
_g_boolean_var_162 =<br>
#22 0x8e8820e2 in gst_ffmpegviddec_handle_frame (decoder=0xb3dcc368, frame=0x8b7d9e90) at /usr/src/debug/gst-ffmpeg-1.45.0.tv-74.arm/ext/ffmpeg/gstffmpegviddec.c:2645<br>
ffmpegdec = 0xb3dcc368<br>
oclass =<br>
data =<br>
size =<br>
got_frame =<br>
minfo = {memory = 0xa5fdfd20, flags = GST_MAP_READ, data = 0xa5fdfd70 "", size = 350, maxsize = 353, user_data = {0xb3dcc2d8, 0xffffffff, 0xaf5bb708, 0x0}, _gst_reserved = {0xb5fcc2c0 &lt;__GI___libc_malloc+348&gt;, 0xc, 0xaf5c9430, 0xa40f88ec &lt;_gst_debug_min&gt;}}<br>
ret = GST_FLOW_OK<br>
packet = {buf = 0x0, pts = 0, dts = 0, data = 0x8b7c62f0 "", size = 350, stream_index = 0, flags = 0, side_data = 0x0, side_data_elems = 0, duration = 0, pos = 0, convergence_duration = 0, discontinuity_info = {discontinuous_flag = 0, audio_properties_changed = 0, timescale = 0, sample_rate = 0, channels = 0, extradata = 0x0, extradata_size = 0, bits_per_coded_sample = 0, block_align = 0, bit_rate = 0, engine_bitrate = 0, codec_tag = 0, codec_id = AV_CODEC_ID_NONE, discontinuousFlagSubtitle = 0, subtitle_index = 0}, user_flag = 0, skipped_rubbish_data = 0, psa_param = 0x0}<br>
func = "gst_ffmpegviddec_handle_frame"<br>
#23 0xa320a08e in gst_video_decoder_decode_frame (decoder=decoder@entry=0xb3dcc368, frame=frame@entry=0x8b7d9e90) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gst-plugins-base/gst-libs/gst/video/gstvideodecoder.c:4026<br>
priv =<br>
decoder_class = 0xaf5bb708<br>
ret = GST_FLOW_OK<br>
func = "gst_video_decoder_decode_frame"<br>
#24 0xa320a4fe in gst_video_decoder_chain_forward (decoder=decoder@entry=0xb3dcc368, buf=, buf@entry=0xa5fc7ce8, at_eos=at_eos@entry=0) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gst-plugins-base/gst-libs/gst/video/gstvideodecoder.c:2498<br>
frame = 0x8b7d9e90<br>
was_keyframe =<br>
priv = 0xb3dcc1d0<br>
klass =<br>
ret = GST_FLOW_OK<br>
func = "gst_video_decoder_chain_forward"<br>
#25 0xa320c4fa in gst_video_decoder_chain (pad=, parent=0xb3dcc368, buf=0xa5fc7ce8) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gst-plugins-base/gst-libs/gst/video/gstvideodecoder.c:2840<br>
decoder = 0xb3dcc368<br>
ret = GST_FLOW_OK<br>
func = "gst_video_decoder_chain"<br>
#26 0xa4064dd0 in gst_pad_chain_data_unchecked (pad=pad@entry=0xa7a90358, type=type@entry=4112, data=, data@entry=0xa5fc7ce8) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gstpad.c:4486<br>
chainfunc = 0xa320c2d1 &lt;gst_video_decoder_chain&gt;<br>
ret =<br>
parent = 0xb3dcc368<br>
handled = 0<br>
func = "gst_pad_chain_data_unchecked"<br>
_g_boolean_var_327 =<br>
g_boolean_var_333 =<br>
#27 0xa4066a6a in gst_pad_push_data (pad=pad@entry=0xb3dcd868, type=type@entry=4112, data=data@entry=0xa5fc7ce8) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gstpad.c:4762<br>
peer = 0xa7a90358<br>
ret = GST_FLOW_OK<br>
handled = 0<br>
func = "gst_pad_push_data"<br>
#28 0xa406c7c6 in gst_pad_push (pad=pad@entry=0xb3dcd868, buffer=0xa5fc7ce8) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gstpad.c:4881<br>
res =<br>
func = "gst_pad_push"<br>
#29 0xa361578e in gst_base_src_loop (pad=0xb3dcd868) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/libs/gst/base/gstbasesrc.c:3143<br>
src = 0x898e8dd0<br>
buf = 0xa5fc7ce8<br>
ret =<br>
position =<br>
eos = 0<br>
blocksize =<br>
pending_events =<br>
tmp =<br>
func = "gst_base_src_loop"<br>
#30 0xa4093a7e in gst_task_func (task=0xb3dd0578) at /usr/src/debug/gstreamer-1.22.8-1.arm/build/../subprojects/gstreamer/gst/gsttask.c:384<br>
lock = 0xb3dcd8b4<br>
tself = 0x89a7f030<br>
priv = 0xb3dd0548<br>
func = "gst_task_func"<br>
#31 0xb5d93ada in g_thread_pool_free (pool=0x36ab998, immediate=-1987151296, wait=-1430260240) at /usr/src/debug/glib2-2.80.5-0.arm/_build/../glib/gthreadpool.c:913<br>
real = 0x36ab998<br>
func = "g_thread_pool_free"<br>
#32 0xaabff5f0 in ?? ()<br>
No symbol table info available.<br>
Backtrace stopped: previous frame identical to this frame (corrupt stack?)<br>
#GDB_PC_Start#<br>
$1 = 0xb5f87c20<br>
#GDB_PC_End#<br>
#GDB_LR_Start#<br>
$2 = 0xa41fb760<br>
#GDB_LR_End#</p>
<p>下面是我对这次崩溃（SIGSEGV）的快速“体检报告”和可执行的定位/止血方案。结论先行：在 gst_buffer_copy_into() 的一次深拷贝（basesink drain / last-sample）过程中，发生了对视频帧内存的非法 memcpy。堆栈与局部变量显示内存结构已被破坏（结构体字段被写成了指针值），高度怀疑是ABI/版本不匹配或插件越界导致的系统内存型 (GstSystemMemory) 复制崩溃。</p>
<ol>
<li>现场证据（来自你贴的 bt / bt full）</li>
</ol>
<p>触发点：<br>
#5 memcpy -&gt; #7 _sysmem_copy -&gt; #8 gst_buffer_copy_into -&gt; #11 gst_base_sink_drain -&gt; #12 gst_base_sink_default_query -&gt; #13 gst_fake_sink_query ...<br>
这条链路说明：下游 sink（这里是 fakesink）在做 query / drain 时，对最后一帧（last-sample）做了深拷贝，结果在 memcpy 时崩了。</p>
<p>正在拷贝的大小：tocopy = 3110400。<br>
这是 1920×1080 的 YUV420 (NV12/I420) 典型大小：1920×1080×1.5 = 3,110,400（确认无误）。</p>
<p>但同一帧调用里也出现了 size = 4,953,600（在其中一次 gst_buffer_copy_into() 的参数里能看到）。这不是常见的未对齐 stride 值（反常）。</p>
<p>单纯 stride=2560（对齐到256/512常见）时，NV12 总大小是 2560×1080×1.5 = 4,147,200；要到 4,953,600 需要一个奇怪的 stride≈3056。说明“视图尺寸/stride/plane信息”和“实际内存布局”之间可能不一致。</p>
<p>关键的“内存破坏”线索（致命）：在<br>
#16 gst_video_decoder_negotiate_pool 里打印的局部变量：</p>
<p>allocator = 0x8b7d9a30<br>
params = { flags = GST_MEMORY_FLAG_ZERO_PADDED,<br>
align = 0, prefix = 0,<br>
padding = 2340264496,  // ← 这数值巨大且异常<br>
_gst_reserved = {0xb05da800, 0xa40c55c4, 0x1, 0xb3dcc368} }</p>
<p>其中 padding = 2340264496 非常异常（padding 应该是个很小的字节数，常为 0/几几十字节），而 2340264496 == 0x8B7D9A30，恰好等于上面的 allocator 指针值。<br>
这几乎可以断定：某处把结构体的字段踩成了指针（典型的 ABI 不匹配 / 结构体大小不一致 / 越界写 / 未初始化内存被当作有效结构使用）。</p>
<p>参与者：gst-ffmpeg-1.45.0.tv-74.arm/ext/ffmpeg/gstffmpegviddec.c（厂商定制版），gstreamer-1.22.8，glibc-2.30。线程名 video_appsrc-sr，显示是你们的 appsrc 推流线程在跑。<br>
结论：崩在 sink 的深拷贝，但元凶更可能在上游（解码器或之前）已经把内存/结构踩坏了。</p>
<ol start="2">
<li>更可能的根因（按概率排序）</li>
</ol>
<p>ABI / 版本不匹配</p>
<p>你运行环境是 gstreamer-1.22.8，而视频解码插件来自 gst-ffmpeg-1.45.0.tv-74.arm（显然是供应商 fork）。</p>
<p>若插件是用与运行时不同的小版本头文件编出来，或者开了与运行时不同的编译选项（结构体对齐/packing/宏定义），就会出现结构体布局不一致，进而把诸如 GstAllocatorParams 等结构体字段打乱，把 padding 写成了 allocator 指针这样的典型事故。</p>
<p>这类问题高度吻合你现在看到的字段值。</p>
<p>插件或上游元素越界写 / 未正确设置 VideoMeta / stride / plane 信息</p>
<p>输出 GstBuffer 未携带正确的 GstVideoMeta 或 plane/stride 信息，或把 planar 数据当成线性内存，在后续深拷贝时 memcpy 走错总长度。</p>
<p>或者复用/释放了仍在使用的内存（pool 回收后仍被 last-sample 深拷贝访问）。</p>
<p>应用侧 appsrc 传的 caps/对齐/尺寸不一致（概率略低，因为崩点出现在 decode→sink 路径，且 mem=system memory）</p>
<p>如果你们上游是从非标准对齐的帧（带奇怪 stride）转换过来，且中途 meta 丢失或被误用，也会造成“看上去要拷 X 字节，实际只有 Y 字节”的 memcpy。</p>
<ol start="3">
<li>立刻可做的“止血”措施（不改源码也能验证/规避）</li>
</ol>
<p>这些动作的目的：绕开 basesink 的“last-sample 深拷贝”，并强制一段更“保守/标准”的视频路径，看看是否不再崩溃，从而验证问题点。</p>
<p>禁用 sink 的 last-sample 深拷贝</p>
<p>给下游 fakesink 加：enable-last-sample=false（这行最关键）。</p>
<p>还可临时加上 sync=false 把同步影响排除（仅用于定位）。</p>
<p>如果你不是 fakesink，而是其他 sink，同理加上相应属性（很多基于 GstBaseSink 的元素都有 enable-last-sample）。</p>
<p>在 decoder 和 sink 之间插一段“规范化”链路</p>
<p>例如：... ! videoconvert ! videoscale ! video/x-raw,format=NV12, width=..., height=..., interlace-mode=progressive ! ...</p>
<p>目的：强制生成严格一致的 plane/stride/caps，避免 vendor 插件输出的“奇怪内存布局”直接落到 sink。</p>
<p>插入 identity check-live=true silent=false 看看是否会报错，以及在不改变内存的情况下跟踪 buffer 的生命周期（加日志）。</p>
<p>若按上面两点后崩溃消失，可以基本锁定：basesink 的深拷贝碰到了被破坏/不一致的内存。</p>
<ol start="4">
<li>必做的版本/ABI 健康检查（高价值）</li>
</ol>
<p>在目标设备上跑：</p>
<p>gst-inspect-1.0 | grep -i ffmpeg / gst-inspect-1.0 | grep -i libav<br>
确认用的到底是 gst-libav 还是 gst-ffmpeg fork，版本号、路径（和你堆栈里的一致吗）。</p>
<p>确认这套插件**是用同一个 GStreamer 头文件版本（1.22.x）**编的，并与运行时完全一致（小版本差异也可能踩雷）。</p>
<p>如果能做到：用同版本的 GStreamer SDK 重新干净编译这个 ffmpeg 插件，关闭不必要的 vendor patch 尝试一次。</p>
<p>运行时调试环境变量（能极大帮助定位）：</p>
<p>export GST_DEBUG="GST_BUFFER:6,GST_MEMORY:6,gstbasesink:6,gstvideo*:6,ffmpeg*:6"<br>
export GST_DEBUG_FILE=/tmp/gst-crash.log<br>
export G_SLICE=always-malloc<br>
export G_DEBUG=gc-friendly<br>
export MALLOC_PERTURB_=153     # 或 123 等，帮助暴露越界</p>
<p>观察崩溃前的几帧：caps、stride、plane、buffer size、pool/allocator 以及 last-sample 的拷贝路径。</p>
<ol start="5">
<li>用 gdb/coredump 继续佐证“内存被踩”的快速命令</li>
</ol>
<p>在 coredump 里（你已有符号信息）：</p>
<h1>看看崩点这一帧的 src/dest 指针和值是否像样</h1>
<p>frame 8<br>
p mem<br>
p *mem<br>
p mem-&gt;size<br>
p mem-&gt;maxsize<br>
p mem-&gt;data<br>
x/32bx mem-&gt;data</p>
<h1>看看目标新内存 newmem 的情况</h1>
<p>p newmem<br>
p *newmem</p>
<h1>再回到 #16 看 negotiate_pool 的 params 是否总是异常</h1>
<p>frame 16<br>
p allocator<br>
p params</p>
<p>如果你每次崩溃时 params.padding 都是一个“像指针”的巨大值（甚至等于 allocator），那就能非常自信地把锅指向 ABI/结构体踩踏。</p>
<ol start="6">
<li>如果必须继续运行：工程侧的临时规避组合（建议）</li>
</ol>
<p>... ! ffmpegdec ! videoconvert ! videoscale ! capsfilter(标准NV12/对齐) ! queue max-size-buffers=1 leaky=downstream ! fakesink enable-last-sample=false sync=false</p>
<p>若你们不是用 fakesink，而是自己写的 sink（或 appsink）：同样禁用 last-sample或避免在 query/drain 时做深拷贝。</p>
<ol start="7">
<li>根治路线（源码/打包层面）</li>
</ol>
<p>统一 GStreamer 运行时与编译时版本</p>
<p>用 同一版本（例如 1.22.8 全家桶） 重新编译你们的 gst-ffmpeg（或改用 upstream gst-libav 对应小版本）。</p>
<p>检查编译选项（结构体对齐、交叉编译 ABI、-mfloat-abi/-mfpu 等）全部一致。</p>
<p>审查 gstffmpegviddec.c 的输出路径</p>
<p>确保为 planar 格式填充正确的 GstVideoMeta（stride/offset/plane），不要把多 plane 当作一块线性内存。</p>
<p>确保没有把 ffmpeg 的 AVFrame 直接用“错误大小”的 GstMemory 包装。</p>
<p>确保 buffer/pool 回收前不会被 “last-sample 深拷贝”再访问——如果可能，给输出加上 gst_buffer_make_writable 并复制必要元数据。</p>
<p>回退/替换插件验证</p>
<p>临时换成 upstream 的 gst-libav 相同小版本插件包测试（不带 vendor patch）。</p>
<p>如果问题消失，说明 vendor fork 有越界/ABI 问题；可用最小差异法逐步引入 patch 找元凶。</p>
<ol start="8">
<li>小结（一句话）</li>
</ol>
<p>表象：在 GstBaseSink 深拷贝 last-sample 时 memcpy 崩溃。</p>
<p>铁证：GstAllocatorParams.padding 被写成了一个指针大小（等于 allocator 地址）。</p>
<p>高概率根因：gst-ffmpeg（vendor 版）与 GStreamer 运行时 ABI/结构体布局不匹配或插件越界写。</p>
<p>止血：禁用 enable-last-sample，插入 videoconvert/videoscale/capsfilter 规范化链路。</p>
<p>根治：统一版本重编插件/改用 upstream，同步检查 VideoMeta/plane/stride 的正确性。</p>
<p>需要我根据你当前的 pipeline 把“止血版命令/代码片段”直接改好（比如 .NET/Tizen 里如何设置 fakesink 属性、如何插 videoconvert / capsfilter），我就直接给到可粘贴的版本。</p></div>
<div style="font-size:small;margin-top:8px;float:right;"></div>

<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">评论</button>
<div class="comments" id="comments"></div>

</div>
    <div id="footer"><div id="footer1">Copyright © <span id="copyrightYear"></span> <a href="https://lhmax2010.github.io">Blog Title</a></div>
<div id="footer2">
    <span id="runday"></span><span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a></span>
</div>

<script>
var now=new Date();
document.getElementById("copyrightYear").innerHTML=now.getFullYear();

if(""!=""){
    var startSite=new Date("");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("runday").innerHTML="网站运行"+diffDay+"天"+" • ";
}
</script></div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z'};
var utterancesLoad=0;

let themeSettings={
    "dark": ["dark","moon","#00f0ff","dark-blue"],
    "light": ["light","sun","#ff5000","github-light"],
    "auto": ["auto","sync","","preferred-color-scheme"]
};
function changeTheme(mode, icon, color, utheme){
    document.documentElement.setAttribute("data-color-mode",mode);
    document.getElementById("themeSwitch").setAttribute("d",value=IconList[icon]);
    document.getElementById("themeSwitch").parentNode.style.color=color;
    if(utterancesLoad==1){utterancesTheme(utheme);}
}
function modeSwitch(){
    let currentMode=document.documentElement.getAttribute('data-color-mode');
    let newMode = currentMode === "light" ? "dark" : currentMode === "dark" ? "auto" : "light";
    localStorage.setItem("meek_theme", newMode);
    if(themeSettings[newMode]){
        changeTheme(...themeSettings[newMode]);
    }
}
function utterancesTheme(theme){
    const message={type:'set-theme',theme: theme};
    const iframe=document.getElementsByClassName('utterances-frame')[0];
    iframe.contentWindow.postMessage(message,'https://utteranc.es');
}
if(themeSettings[theme]){changeTheme(...themeSettings[theme]);}
console.log("\n %c Gmeek last https://github.com/Meekdai/Gmeek \n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);



function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","lhmax2010/lhmax2010.github.io");
    script.setAttribute("issue-term","title");
    
    if(localStorage.getItem("meek_theme")=="dark"){script.setAttribute("theme","dark-blue");}
    else if(localStorage.getItem("meek_theme")=="light") {script.setAttribute("theme","github-light");}
    else{script.setAttribute("theme","preferred-color-scheme");}
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}



</script>


</html>
